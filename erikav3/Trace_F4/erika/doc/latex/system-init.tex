\doxysection{System and application initialization }
\hypertarget{system-init}{}\label{system-init}\index{System and application initialization@{System and application initialization}}
The typical initialization workflow of an ERIKA3 application works as follows\+:


\begin{DoxyItemize}
\item At the microcontroller reset, typically a routine (traditionally named on most microcontrollers {\itshape crt0}) is executed which is responsible for the initialization of the microcontroller memory. That initialization is typically divided in three parts\+:
\begin{DoxyItemize}
\item a memory copy of the initialized data memory;
\item a cleanup (set to 0) of the BSS area;
\item an initialization of the stack to a given fillpattern (typically for ERIKA3 the fillpattern is 0x\+A5\+A5\+A5\+A5, and is used by debuggers using the ORTI specification to later on determine the stack usage in the system).
\end{DoxyItemize}
\item After the initialization routine, the code jumps to the main() function;
\item The main() function executes some implementation dependent code, and finally calls \doxylink{group__primitives-startup_ga1c71c32e3d5e1d67037b86488e6410af}{Start\+OS()}, which is the last function call of the main().
\item The call to \doxylink{group__primitives-startup_ga1c71c32e3d5e1d67037b86488e6410af}{Start\+OS()} calls the \doxylink{group__primitives-hook_ga18397d2c939dd63649ec1f63213a51b4}{Startup\+Hook()}, handles the task and alarms autostart, and finally starts the first ready task.
\item \doxylink{group__primitives-startup_ga1c71c32e3d5e1d67037b86488e6410af}{Start\+OS()} is also responsible for the background task. By default, the background task is implemented as a forever loop that continuously calls the {\itshape idle hook} specified in the OIL File. \doxylink{group__primitives-startup_ga1c71c32e3d5e1d67037b86488e6410af}{Start\+OS()} never returns.
\end{DoxyItemize}

As for the application initialization, in general, there are various places where the application designer may put the application startup code\+:


\begin{DoxyItemize}
\item in the main() function, before the call to \doxylink{group__primitives-startup_ga1c71c32e3d5e1d67037b86488e6410af}{Start\+OS()}. This case is typically used for non-\/\+OS related initializations, because calling ERIKA3 primitives before \doxylink{group__primitives-startup_ga1c71c32e3d5e1d67037b86488e6410af}{Start\+OS()} may have in general unpredictable results. It is noit safe to activate peripheral raising ISR Type 2 in this part of the code, unless you can guarantee that any ISR Type 2 will be raised after the \doxylink{group__primitives-startup_ga1c71c32e3d5e1d67037b86488e6410af}{Start\+OS()} call.
\item inside \doxylink{group__primitives-hook_ga18397d2c939dd63649ec1f63213a51b4}{Startup\+Hook()}. This case is used for the initializations that require a call to a limited number of ERIKA3 primitives. Please note that \doxylink{group__primitives-hook_ga18397d2c939dd63649ec1f63213a51b4}{Startup\+Hook()} is called before the rescheduling in \doxylink{group__primitives-startup_ga1c71c32e3d5e1d67037b86488e6410af}{Start\+OS()} takes place, with {\itshape interrupt disabled}.
\item inside a task automatically activated with AUTOSTART. In this case you need to create a {\itshape startup} task which is responsible for the initial application initialization and peripheral setting. 
\end{DoxyItemize}