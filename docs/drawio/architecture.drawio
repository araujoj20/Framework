<mxfile host="Electron" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/28.0.6 Chrome/138.0.7204.100 Electron/37.2.3 Safari/537.36" version="28.0.6">
  <diagram id="layered-arch" name="Architecture (Layered)">
    <mxGraphModel dx="2000" dy="1203" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1920" pageHeight="1080" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="app" value="Application" style="rounded=1;whiteSpace=wrap;html=1;fontStyle=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="40" y="40" width="1040" height="210" as="geometry" />
        </mxCell>
        <mxCell id="victim" value="Victim Task" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;" parent="app" vertex="1">
          <mxGeometry x="20" y="20" width="340" height="170" as="geometry" />
        </mxCell>
        <mxCell id="tinycrypt" value="TinyCrypt AES" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#b9e0b7;strokeColor=#82b366;" parent="victim" vertex="1">
          <mxGeometry x="20" y="90" width="300" height="60" as="geometry" />
        </mxCell>
        <mxCell id="spy" value="Spy Task" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f4cccc;strokeColor=#b85450;fontStyle=1;" parent="app" vertex="1">
          <mxGeometry x="680" y="20" width="340" height="170" as="geometry" />
        </mxCell>
        <mxCell id="dmaSetup" value="DMA Setup (src/dst/len)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8d5d5;strokeColor=#b85450;" parent="spy" vertex="1">
          <mxGeometry x="20" y="15" width="300" height="40" as="geometry" />
        </mxCell>
        <mxCell id="timerCtl" value="Timer Control (start/stop/read)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8d5d5;strokeColor=#b85450;" parent="spy" vertex="1">
          <mxGeometry x="20" y="65" width="300" height="40" as="geometry" />
        </mxCell>
        <mxCell id="traceCore" value="Trace Core (timestamps + ring buffer)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8d5d5;strokeColor=#b85450;" parent="spy" vertex="1">
          <mxGeometry x="20" y="115" width="300" height="40" as="geometry" />
        </mxCell>
        <mxCell id="rtos" value="FreeRTOS / Operating System" style="rounded=1;whiteSpace=wrap;html=1;fontStyle=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="40" y="270" width="1040" height="110" as="geometry" />
        </mxCell>
        <mxCell id="rtosQueue" value="Queue: trace_out" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1f0ff;strokeColor=#6c8ebf;" parent="rtos" vertex="1">
          <mxGeometry x="20" y="20" width="220" height="30" as="geometry" />
        </mxCell>
        <mxCell id="rtosSem" value="Semaphore/Event: dma_done" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1f0ff;strokeColor=#6c8ebf;" parent="rtos" vertex="1">
          <mxGeometry x="20" y="60" width="260" height="30" as="geometry" />
        </mxCell>
        <mxCell id="hal" value="HAL/LL + ISRs" style="rounded=1;whiteSpace=wrap;html=1;fontStyle=1;fillColor=#eeeeee;strokeColor=#888888;" parent="1" vertex="1">
          <mxGeometry x="40" y="420" width="1040" height="60" as="geometry" />
        </mxCell>
        <mxCell id="halApi" value="HAL API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#888888;" parent="hal" vertex="1">
          <mxGeometry x="20" y="15" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="dmaIrq" value="DMA IRQ (TC/HT/ERR)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#888888;" parent="hal" vertex="1">
          <mxGeometry x="170" y="15" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="timIrq" value="TIM IRQ" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#888888;" parent="hal" vertex="1">
          <mxGeometry x="370" y="15" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="hw" value="Hardware (STM32F407)" style="rounded=1;whiteSpace=wrap;html=1;fontStyle=1;fillColor=#f5f5f5;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="40" y="520" width="1040" height="250" as="geometry" />
        </mxCell>
        <mxCell id="bus" value="AHB/APB Bus Matrix" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;" parent="hw" vertex="1">
          <mxGeometry x="20" y="20" width="300" height="40" as="geometry" />
        </mxCell>
        <mxCell id="sram" value="SRAM" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;" parent="hw" vertex="1">
          <mxGeometry x="20" y="80" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="flash" value="Flash" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;" parent="hw" vertex="1">
          <mxGeometry x="180" y="80" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="dmaCtrl" value="DMA Controller" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;" parent="hw" vertex="1">
          <mxGeometry x="360" y="80" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="timer" value="Timer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;" parent="hw" vertex="1">
          <mxGeometry x="560" y="80" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uart" value="UART / ITM / SWO" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;" parent="hw" vertex="1">
          <mxGeometry x="700" y="80" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="note1" value="DMA latency &gt; threshold ⇒ possível acesso de memória pelo Victim" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff2cc;strokeColor=#d6b656;" parent="hw" vertex="1">
          <mxGeometry x="740" width="300" height="80" as="geometry" />
        </mxCell>
        <mxCell id="eVictimTiny" style="endArrow=block;endFill=1;strokeColor=#82b366;" parent="1" source="victim" target="tinycrypt" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eTinyToSRAM" style="endArrow=block;endFill=1;dashed=0;strokeColor=#82b366;" parent="1" source="tinycrypt" target="sram" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eTinyToFlash" style="endArrow=block;endFill=1;dashed=0;strokeColor=#82b366;" parent="1" source="tinycrypt" target="flash" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eSpyToHAL" style="endArrow=block;endFill=1;strokeColor=#b85450;" parent="1" source="spy" target="halApi" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eHALtoDMA" style="endArrow=block;endFill=1;strokeColor=#888888;" parent="1" source="halApi" target="dmaCtrl" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eHALtoTIM" style="endArrow=block;endFill=1;strokeColor=#888888;" parent="1" source="halApi" target="timer" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eDMAIRQtoRTOS" style="endArrow=block;endFill=1;strokeColor=#888888;" parent="1" source="dmaIrq" target="rtosSem" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eTraceToQueue" style="endArrow=block;endFill=1;strokeColor=#b85450;" parent="1" source="traceCore" target="rtosQueue" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eQueueToUART" style="endArrow=block;endFill=1;strokeColor=#6c8ebf;" parent="1" source="rtosQueue" target="uart" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eRTOSManageVictim" style="endArrow=block;endFill=1;dashed=1;strokeColor=#6c8ebf;" parent="1" source="rtos" target="victim" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eRTOSManageSpy" style="endArrow=block;endFill=1;dashed=1;strokeColor=#6c8ebf;" parent="1" source="rtos" target="spy" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
